<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">-->
    <title>El Ahorcado</title>
</head>

<body>   
    <div class="container">      
        <h1 class="text-center">El Ahorcado</h1>
        <label for="campoNombre" id="nombreusuario">Ingrese su usuario</label>
        <input type="text" id="campoNombre" />
        <button id="aceptarNombre" onclick="nombre()">Aceptar</button>
        <div class="float-right">Intentos fallidos <span id="fallos">0</span> of <span id="maximosFallos"></span></div>
        <div class="text-center">
            <img id='hangmanPic' src="./images/0.jpg" alt="">
            <p>Adivina la palabra</p>
            <p id="palabraResaltada"></p>
            <div id="keyboard"></div>
        </div>
        <button id="jugarNuevo" style="visibility: hidden;" onclick="reiniciar()">Jugar de nuevo</button>
    </div>

</body>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background-color: #fff;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    h1 {
        text-align: center;
        color: #333;
    }

    label {
        display: block;
        margin-bottom: 10px;
        font-weight: bold;
    }

    input[type="text"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    button {
        padding: 10px 20px;
        background-color: #333;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .float-right {
        float: right;
    }

    #hangmanPic {
        max-width: 100%;
        height: auto;
        margin-bottom: 10px;
    }

    p {
        margin-bottom: 10px;
    }

    #keyboard {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
    }

    #keyboard button {
        margin: 5px;
        padding: 10px 20px;
        background-color: #ccc;
        color: #333;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }


    #keyboard button:hover {
        background-color: #999;
        color: #fff;
    }


    #jugarNuevo {
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #333;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
</style>

<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript">

    const socket = io('http://localhost:4000');

    let answer = '';
    let palabrau = '';
    let general = [];
    let anfitrion = '';
    let todosletras = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'ñ', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z'];
    let leusadas = [];
    let leactual = '';
    let partida = false;
    let usuario = 'pepito perez';

    socket.on('palabra-recibir', (palabra, id) => {
        palabrau = palabra;
        anfitrion = id;
        console.log(palabrau, anfitrion)
        document.getElementById('palabraResaltada').innerHTML = palabrau.split('').map(letter => (general.indexOf(letter) >= 0 ? letter : " _ ")).join('');
        document.getElementById('maximosFallos').innerHTML = 6;
    })

    function ganar() {
        if (document.getElementById('palabraResaltada').innerHTML.indexOf('_') == -1) {
            alert('Ganaste, Felicitaciones');
            socket.emit('ganador', usuario);
            document.getElementById('jugarNuevo').style.visibility = 'visible';
        }
    }

    function nombre() {
        usuario = document.getElementById('campoNombre').value;
        for (let i = 0; i < todosletras.length; i++) {
            document.getElementById(todosletras[i]).disabled = false;
        }
        document.getElementById('campoNombre').style.visibility = 'hidden';
        document.getElementById('aceptarNombre').style.visibility = 'hidden';
        document.getElementById('nombreusuario').style.visibility = 'hidden';
    }

    reiniciar = () => {
        location.reload();
    }

    function perdida() {
        alert('Perdiste, la palabra era: ' + palabrau);
        document.getElementById('jugarNuevo').style.visibility = 'visible';
    }

    socket.on('ganador-a-todos', (usuario) => {
        alert('El ganador es: ' + usuario);
        for (let i = 0; i < todosletras.length; i++) {
            document.getElementById(todosletras[i]).disabled = false;
        }
    })

    socket.on('respuesta-a-usuario', (respuesta) => {
        if (respuesta == 1) {
            general.indexOf(leactual) === -1 ? general.push(leactual) : null;
            if (palabrau.indexOf(leactual) >= 0) {
                document.getElementById('palabraResaltada').innerHTML = palabrau.split('').map(letter => (general.indexOf(letter) >= 0 ? letter : " _ ")).join('');
            }
        } else if (respuesta == 0) {
            document.getElementById('fallos').innerHTML = parseInt(document.getElementById('fallos').innerHTML) + 1;
            switch (parseInt(document.getElementById('fallos').innerHTML)) {
                case 1:
                    document.getElementById('hangmanPic').src = './images/1.jpg';
                    break;
                case 2:
                    document.getElementById('hangmanPic').src = './images/2.jpg';
                    break;
                case 3:
                    document.getElementById('hangmanPic').src = './images/3.jpg';
                    break;
                case 4:
                    document.getElementById('hangmanPic').src = './images/4.jpg';
                    break;
                case 5:
                    document.getElementById('hangmanPic').src = './images/5.jpg';
                    break;
                case 6:
                    document.getElementById('hangmanPic').src = './images/6.jpg';
                    break;
                default:
                    break;
            }
        }
        ganar();
        for (let i = 0; i < todosletras.length; i++) {
            document.getElementById(todosletras[i]).disabled = false;
        }
        for (let i = 0; i < leusadas.length; i++) {
            document.getElementById(leusadas[i]).disabled = true;
        }
        if (parseInt(document.getElementById('fallos').innerHTML) >= 6) {
            for (let i = 0; i < todosletras.length; i++) {
                document.getElementById(todosletras[i]).disabled = true;
            }
            socket.emit('perdedor', usuario);
            perdida();
        }
    })

    function generadorBotones() {
        let buttonsHTML = 'abcdefghijklmnñopqrstuvwxyz'.split('').map(letter =>
            `
        <button 
        class="btn btn-lg btn-primary m-2" 
        id='` + letter + `'
        name="btn letras" 
        onClick="handleGuess('` + letter + `')"
        disabled="true"
        >  
        ` + letter + `
        </button>  
        `
        ).join('');
        document.getElementById('keyboard').innerHTML = buttonsHTML;
    }

    function handleGuess(letraEscogida) {
        socket.emit('partida-empezada', (Response) => {
            partida = Response;
            if (partida == false) {
                alert('Espera a que el anfitrion empiece la partida');
            } else if (partida == true && document.getElementById('palabraResaltada').innerHTML == '') {
                alert('La partida ya empezo, espera a que el anfitrion empieze una nueva partida');
            } else {
                document.getElementById(letraEscogida).setAttribute('disabled', true);
                leusadas.push(letraEscogida);
                leactual = letraEscogida;
                socket.emit('letra-enviada', letraEscogida, socket.id, usuario);
                for (let i = 0; i < todosletras.length; i++) {
                    document.getElementById(todosletras[i]).disabled = true;
                }
            }
        });
    }

    function status() {

    }

    generadorBotones();

</script>

</html>